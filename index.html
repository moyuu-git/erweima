<!doctype html>
<html>
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>您的近日命理图示</title>
<style>
html,body { margin:0; height:100%; font-family: "SansSerif", Arial, Helvetica; background:#fff; }
canvas { display:block; }
#title { position:absolute; top:20px; width:100%; text-align:center; font-size:28px; font-weight:bold; }
#analysis { position:absolute; top:calc(50% + 250px); width:100%; text-align:center; font-size:16px; line-height:1.4em; }
#golden { position:absolute; top:calc(50% + 350px); width:100%; text-align:center; font-size:18px; font-weight:bold; color:#c60; }
#saveBtn { position:absolute; bottom:40px; left:50%; transform:translateX(-50%); padding:10px 20px; border:none; background:#333; color:#fff; border-radius:6px; font-size:16px; cursor:pointer; }
</style>
</head>
<body>

<div id="title">您的近日命理图示</div>
<div id="analysis"></div>
<div id="golden"></div>
<button id="saveBtn">保存今日命理运势</button>

<script src="https://cdn.jsdelivr.net/npm/p5@1.6.0/lib/p5.min.js"></script>
<script>
let orbs=[], dusts=[], angleOffset=0;
const palette = ['#ED00B7','#0E03DE','#D0EFFA','#FFCE00','#9E0010'];

// 积极荒诞小金句
const goldenSentences = [
  "今日行动必有收获，或者至少你会学到失败的智慧。",
  "保持热情与专注，所有努力终将回报，或者回报会偷偷溜走。",
  "你会大获全胜，否则你会惊讶地发现自己也没输。",
  "好运正在靠近，除非它迷路了。",
  "每一次努力都很重要，即便它只是让你笑了。",
  "今日精神饱满，或许只是精神错乱也无妨。",
  "你的专注会让你成功，或者让你意识到成功并不重要。",
  "每一个决策都至关重要，或者根本无关紧要。"
];

// 页面元素
let analysisDiv, goldenDiv;

function setup(){
  createCanvas(windowWidth, windowHeight);
  analysisDiv = document.getElementById('analysis');
  goldenDiv = document.getElementById('golden');

  // 初始化 orbs + dusts
  for(let i=0;i<12;i++) orbs.push(new Orb(i*TWO_PI/12));
  for(let i=0;i<120;i++) dusts.push(new Dust());

  generateAnalysisText();
}

function draw(){
  background(255);
  push();
  translate(width/2,height/2);

  let speedFactor=1.2;
  let radiusBase = min(width,height)*0.33;
  angleOffset += 0.01*speedFactor;

  // 背景呼吸同心圆
  noFill();
  stroke(0,40);
  for(let r=150;r<=420;r+=60){
    let pulse = 16*sin(frameCount*0.02+r*0.03);
    ellipse(0,0,r+pulse,r+pulse);
  }

  // 八向能量线
  stroke(0,50);
  let linesRot = frameCount*0.0015;
  for(let i=0;i<8;i++){
    let a=i*PI/4+linesRot;
    let inner=90+10*sin(frameCount*0.03+i);
    let outer=radiusBase+70+12*cos(frameCount*0.027+i);
    line(cos(a)*inner,sin(a)*inner,cos(a)*outer,sin(a)*outer);
  }

  // 尘埃
  noStroke();
  for(let d of dusts){ d.update(); d.display(); }

  // orbs
  for(let i=0;i<orbs.length;i++){
    let o = orbs[i];
    let radius = radiusBase*(0.86 + 0.14*sin(frameCount*0.01+i*0.7));
    if(i===0){ o.scale = 1.2; radius*=1.2; } else o.scale=1.0;
    o.update(angleOffset,radius);
    o.display();
  }

  pop();
}

function windowResized(){ resizeCanvas(windowWidth,windowHeight); }

// --- Orb类 ---
class Orb{
  constructor(angle){
    this.angle = angle;
    this.x=0; this.y=0; this.scale=1;
    this.col=color(palette[int(random(palette.length))]);
  }
  update(offset,radius){
    this.x = cos(this.angle+offset)*radius;
    this.y = sin(this.angle+offset)*radius;
  }
  display(){
    let baseSize = 60*this.scale;
    noStroke();
    fill(this.col,205);
    ellipse(this.x,this.y,baseSize,baseSize);
    noFill();
    stroke(this.col,70);
    let halo = baseSize + 22*sin(frameCount*0.05+this.angle*3.0);
    ellipse(this.x,this.y,halo,halo);
  }
}

// --- Dust类 ---
class Dust{
  constructor(){
    this.radius=random(100,480);
    this.angle=random(TWO_PI);
    this.speed=random(0.001,0.004);
    this.sz=random(1.2,2.6);
    this.alpha=random(20,60);
  }
  update(){ this.angle+=this.speed; this.radius+=0.25*sin(frameCount*0.01+this.angle*5.0);}
  display(){
    let px=cos(this.angle)*this.radius;
    let py=sin(this.angle)*this.radius;
    noStroke();
    fill(0,this.alpha);
    ellipse(px,py,this.sz,this.sz);
  }
}

// --- 假装分析文本 ---
function generateAnalysisText(){
  // 颜色占比（随机化模拟）
  let rCount=0,bCount=0,yCount=0,lCount=0,dCount=0;
  for(let o of orbs){
    let c = o.col;
    let r=red(c),g=green(c),b=blue(c);
    if(r>200 && g<100 && b>150) rCount++;
    else if(r<50 && g<50 && b>150) bCount++;
    else if(r>200 && g>180 && b<80) yCount++;
    else if(r>200 && g>200 && b>200) lCount++;
    else dCount++;
  }

  let analysisText=`颜色占比：红${rCount}、蓝${bCount}、黄${yCount}、浅${lCount}、暗${dCount}。`;
  analysisText+=`\n八卦呈现色调偏${rCount>=bCount?'暖':'冷'}，象征近期能量${rCount>=bCount?'集中':'均衡'}。`;
  analysisText+=`\n元素偏多的区域提醒您：多关注细节与互动。`;

  analysisDiv.innerText=analysisText;

  // 随机抽取小金句
  let gold = goldenSentences[int(random(goldenSentences.length))];
  goldenDiv.innerText = gold;
}

// --- 保存按钮 ---
document.getElementById('saveBtn').addEventListener('click',()=>{
  // 暂时隐藏按钮避免截图中出现
  let btn = document.getElementById('saveBtn');
  btn.style.display='none';
  saveCanvas('今日命理运势','png');
  btn.style.display='block';
});
</script>
</body>
</html>
